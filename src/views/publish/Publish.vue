<template>
  <div id="publish">
    <el-card class="box-card">
      <div slot="header" class="clearfix">
        <!-- 面包屑路径导航 -->
        <publish-nav></publish-nav>
      </div>
      <publish-form
        ref="publishRef"
        :article="article"
        :channels="channels"
        @handlePublish="loadPublishArticle"
      ></publish-form>
    </el-card>
  </div>
</template>

<script>
import {
  getArticleChannels,
  getArticleList,
  addArticle
} from '@/network/article.js'
import PublishNav from './childComps/PublishNav'
import PublishForm from './childComps/PublishForm'
export default {
  data() {
    return {
      channels: [],
      article: {
        // 文章标题
        title: '',
        // 文章内容
        content: '',
        // 文章封面
        cover: {
          type: 0,
          images: []
        },
        // 频道
        channel_id: null
      },
      draft: false
    }
  },
  components: {
    PublishNav,
    PublishForm
  },
  created() {
    this.loadArticleChannels()
  },
  methods: {
    // 加载频道
    loadArticleChannels() {
      getArticleChannels().then(res => {
        console.log(res)
        this.channels = res.data.channels
      })
    },
    // 添加文章
    loadPublishArticle(msg) {
      console.log(msg)
      this.draft = msg
      console.log(this.draft)
      // console.log(draft)
      console.log(this.article)
      addArticle(this.article, this.draft).then(res => {
        console.log(res)
        console.log(this)
        this.$refs.publishRef.$refs.publishForm.validate(valid => {
          if (valid) {
            this.$router.push({ name: 'article' })
            this.$message.success('发布成功！')
          } else {
            this.$message.warning('请填写必须字段！')
          }
        })
      })
    }
  }
}
</script>

<style scoped>
</style>
